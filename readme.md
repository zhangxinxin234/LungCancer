# 肺癌中医诊疗智能辅助系统

## 主要功能
主要提供以下功能：

- 中医处方生成：根据患者信息生成个性化的中药处方
- 中成药推荐：为患者推荐合适的中成药
- 临床路径推荐：基于CSCO指南为患者匹配合适的临床诊疗路径
- 处方和中成药修复优化：对生成的处方和中成药进行智能修复和优化

## 项目流程

### 数据库sqlite
- 患者信息表：存储患者的基本信息
  - 患者ID、西医诊断、现病程阶段、病理报告、分期、TNM分期、实验室检查、影像学报告、症状、舌苔、脉象、处方、中成药、生成处方、生成中成药、处方修复、中成药修复、西医诊疗分期、西医标准诊疗方案CSCO指南、修复规则
  - 生成处方、生成中成药是模型根据患者信息生成的处方和中成药
  - 处方修复、中成药修复是模型根据修复规则进行修复后的结果
- 修复规则表：存储处方和中成药的修复规则
  - 患者ID、规则内容

### 前端

- 新建患者信息界面：
  - 默认界面：左侧是患者列表，右侧是患者基本信息（西医诊断、现病程阶段、病理报告、分期、TNM分期、实验室检查、影像学报告、症状、舌苔、脉象）
  - 输入患者基本信息（西医诊断、现病程阶段、病理报告、分期、TNM分期、实验室检查、影像学报告、症状、舌苔、脉象）
  - 点击"提交"按钮，将信息保存到数据库，并调用后端接口进行处方生成，进入处方生成界面
  - 点击"新建患者"按钮，自动生成患者ID，为该患者创建数据库表

- 处方生成界面：
  - 展示生成的处方（str）、中成药（str）、西医诊疗分期（str）和西医标准诊疗方案CSCO指南（str：md格式的表格）
  - 点击"保存"按钮，将处方和中成药保存到数据库
  - 点击"处方修复"按钮，进入处方修复界面
  - 点击"返回"按钮，返回患者信息界面

- 处方修复界面：
  - 左侧从上到下依次是处方（str）、处方修复（str）、中成药（str）、中成药修复（str），其中处方和中成药是根据当前user_id从数据库中读取的，右侧是一个文本框，用户可以在文本框中输入处方修复和中成药修复的建议/规则，最下面是"修复"、"采纳"和"返回"按钮
  - 点击"修复"按钮，将修复规则内容入库，调用后端接口进行处方修复和中成药修复，返回修复后的处方和中成药
  - 点击"采纳"按钮，返回处方生成界面


### 后端

- 处方生成：
  - 接收前端传来的患者id，从数据库获取患者基本信息，调用模型进行处方生成，返回生成的处方、中成药、西医诊疗分期和西医标准诊疗方案CSCO指南
  - 将生成的处方和中成药保存到数据库：对应数据库的字段为"生成处方、生成中成药、西医诊疗分期、西医标准诊疗方案CSCO指南"，同时更新患者信息表中的"处方、中成药"字段
  - 伪代码：
```python
async def generate_prescription_and_cmedcine(patient_text:str):
    """
    生成处方推荐和中成药推荐
    """
    # 生成处方推荐    
    prescription_text, medicine_text = "", ""
    # 保存到数据库

    return prescription_text, medicine_text
```

- 处方修复：
  - 接收前端传来的患者id、从数据库获取当前患者的"生成处方、生成中成药"，调用模型进行修复，返回修复后的处方和中成药
  - 将修复后的处方和中成药保存到数据库：对应数据库的字段为"处方修复、中成药修复"
  - 伪代码：
```python
async def system_repair(patient_text: str, pred_prescription: str, pred_medicine: str, rules_text: str=None):
    
    prescription_text = ""
    medicine_text = ""
    result = {
        "prescription": prescription_text,
        "medicine": medicine_text,
    }

    return result

```

- 修复采纳：
  - 接收前端传来的患者id，更新修复规则表中的"规则内容"字段
  - 将患者信息表中的"处方、中成药"字段更新为修复后的处方和中成药。

## 技术栈
- 前端：Flask
- 后端：FastAPI
- 数据库：sqlite

## 要求
- 模块化设计
- 代码注释
- 前后端分离